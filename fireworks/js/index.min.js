var delayButton=document.getElementById("delay"),delay=1e3*delayButton.value;delayButton.onclick=function(){this.style.opacity=1};var Fireworks=function(){var t=this,e=function(t,e){return~~(Math.random()*(e-t+1)+t)},i=function(t,e,i,a,s,r,h,n){var o=!(t+i<s||s+h<t||e+a<r||r+n<e);return o};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),t.init=function(){t.dt=0,t.oldTime=Date.now(),t.canvas=document.createElement("canvas"),t.canvasContainer=document.querySelector("#canvas-container");document.getElementById("canvas-container");t.canvas.onselectstart=function(){return!1},t.canvas.width=t.cw=window.innerWidth,t.canvas.height=t.ch=window.innerHeight,t.particles=[],t.partCount=30,t.fireworks=[],t.mx=t.cw/2,t.my=t.ch/2,t.currentHue=220,t.partSpeed=5,t.partSpeedVariance=10,t.partWind=50,t.partFriction=5,t.partGravity=1,t.hueMin=30,t.hueMax=330,t.fworkSpeed=2,t.fworkAccel=4,t.hueVariance=20,t.flickerDensity=20,t.showShockwave=!1,t.showTarget=!0,t.clearAlpha=25,t.canvasContainer.appendChild(t.canvas),t.ctx=t.canvas.getContext("2d"),t.ctx.lineCap="round",t.ctx.lineJoin="round",t.lineWidth=1,t.bindEvents(),t.canvasLoop(),t.canvas.onselectstart=function(){return!1}};var a=function(i,a,s){this.x=i,this.y=a,this.radius=0,this.coordLast=[{x:i,y:a},{x:i,y:a},{x:i,y:a}],this.angle=e(0,360),this.speed=e(t.partSpeed-t.partSpeedVariance<=0?1:t.partSpeed-t.partSpeedVariance,t.partSpeed+t.partSpeedVariance),this.friction=.9-t.partFriction/100,this.gravity=t.partGravity/2,this.hue=e(s-t.hueVariance,s+t.hueVariance),this.brightness=e(50,80),this.alpha=e(40,100)/100,this.decay=e(10,50)/1e3,this.wind=(e(0,t.partWind)-t.partWind/2)/25,this.lineWidth=t.lineWidth};a.prototype.update=function(e){var a=this.angle*Math.PI/180,s=Math.cos(a)*this.speed,r=Math.sin(a)*this.speed+this.gravity;this.speed*=this.friction,this.coordLast[2].x=this.coordLast[1].x,this.coordLast[2].y=this.coordLast[1].y,this.coordLast[1].x=this.coordLast[0].x,this.coordLast[1].y=this.coordLast[0].y,this.coordLast[0].x=this.x,this.coordLast[0].y=this.y,this.x+=s*t.dt,this.y+=r*t.dt,this.angle+=this.wind,this.alpha-=this.decay,(!i(0,0,t.cw,t.ch,this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)||this.alpha<.05)&&t.particles.splice(e,1)},a.prototype.draw=function(){var i=e(1,3)-1;if(t.ctx.beginPath(),t.ctx.moveTo(Math.round(this.coordLast[i].x),Math.round(this.coordLast[i].y)),t.ctx.lineTo(Math.round(this.x),Math.round(this.y)),t.ctx.closePath(),t.ctx.strokeStyle="hsla("+this.hue+", 100%, "+this.brightness+"%, "+this.alpha+")",t.ctx.stroke(),t.flickerDensity>0){var a=50-t.flickerDensity;if(e(0,a)===a){t.ctx.beginPath(),t.ctx.arc(Math.round(this.x),Math.round(this.y),e(this.lineWidth,this.lineWidth+3)/2,0,2*Math.PI,!1),t.ctx.closePath();var s=e(50,100)/100;t.ctx.fillStyle="hsla("+this.hue+", 100%, "+this.brightness+"%, "+s+")",t.ctx.fill()}}},t.createParticles=function(e,i,s){for(var r=t.partCount;r--;)t.particles.push(new a(e,i,s))},t.updateParticles=function(){for(var e=t.particles.length;e--;){var i=t.particles[e];i.update(e)}},t.drawParticles=function(){for(var e=t.particles.length;e--;){var i=t.particles[e];i.draw()}};var s=function(i,a,s,r){this.startTime=Date.now(),this.x=i,this.y=a,this.startX=i,this.startY=a,this.hitX=!1,this.hitY=!1,this.coordLast=[{x:i,y:a},{x:i,y:a},{x:i,y:a}],this.targetX=s,this.targetY=r,this.speed=t.fworkSpeed,this.angle=Math.atan2(r-a,s-i),this.shockwaveAngle=Math.atan2(r-a,s-i)+90*(Math.PI/180),this.acceleration=t.fworkAccel/100,this.hue=e(t.hueMin,t.hueMax),this.brightness=e(50,80),this.alpha=e(50,100)/100,this.lineWidth=t.lineWidth,this.targetRadius=1};s.prototype.update=function(i){t.ctx.lineWidth=this.lineWidth,t.showTarget&&(this.targetRadius<8?this.targetRadius+=.25*t.dt:this.targetRadius=1*t.dt),delay=1e3*delayButton.value;var a=Date.now();if(a-this.startTime>delay&&(vx=Math.cos(this.angle)*this.speed,vy=Math.sin(this.angle)*this.speed,this.speed*=1+this.acceleration,this.coordLast[2].x=this.coordLast[1].x,this.coordLast[2].y=this.coordLast[1].y,this.coordLast[1].x=this.coordLast[0].x,this.coordLast[1].y=this.coordLast[0].y,this.coordLast[0].x=this.x,this.coordLast[0].y=this.y,this.startX>=this.targetX?this.x+vx<=this.targetX?(this.x=this.targetX,this.hitX=!0):this.x+=vx*t.dt:this.x+vx>=this.targetX?(this.x=this.targetX,this.hitX=!0):this.x+=vx*t.dt,this.startY>=this.targetY?this.y+vy<=this.targetY?(this.y=this.targetY,this.hitY=!0):this.y+=vy*t.dt:this.y+vy>=this.targetY?(this.y=this.targetY,this.hitY=!0):this.y+=vy*t.dt,this.hitX&&this.hitY)){e(0,9);t.createParticles(this.targetX,this.targetY,this.hue),t.fireworks.splice(i,1)}},s.prototype.draw=function(){t.ctx.lineWidth=this.lineWidth;var i=e(1,3)-1;t.ctx.beginPath(),t.ctx.moveTo(Math.round(this.coordLast[i].x),Math.round(this.coordLast[i].y)),t.ctx.lineTo(Math.round(this.x),Math.round(this.y)),t.ctx.closePath(),t.ctx.strokeStyle="hsla("+this.hue+", 100%, "+this.brightness+"%, "+this.alpha+")",t.ctx.stroke(),t.showTarget&&(t.ctx.save(),t.ctx.beginPath(),t.ctx.arc(Math.round(this.targetX),Math.round(this.targetY),this.targetRadius,0,2*Math.PI,!1),t.ctx.closePath(),t.ctx.lineWidth=1,t.ctx.stroke(),t.ctx.restore()),t.showShockwave&&(t.ctx.save(),t.ctx.translate(Math.round(this.x),Math.round(this.y)),t.ctx.rotate(this.shockwaveAngle),t.ctx.beginPath(),t.ctx.arc(0,0,1*(this.speed/5),0,Math.PI,!0),t.ctx.strokeStyle="hsla("+this.hue+", 100%, "+this.brightness+"%, "+e(25,60)/100+")",t.ctx.lineWidth=this.lineWidth,t.ctx.stroke(),t.ctx.restore())},t.createFireworks=function(e,i,a,r){t.fireworks.push(new s(e,i,a,r))},t.updateFireworks=function(){for(var e=t.fireworks.length;e--;){var i=t.fireworks[e];i.update(e)}},t.drawFireworks=function(){for(var e=t.fireworks.length;e--;){var i=t.fireworks[e];i.draw()}},t.bindEvents=function(){function e(e){t.mx=e.pageX,t.my=e.pageY,t.createFireworks(t.cw/2,t.ch,t.mx,t.my)}t.canvas.addEventListener("mousedown",function(i){t.mx=i.pageX,t.my=i.pageY,t.createFireworks(t.cw/2,t.ch,t.mx,t.my),t.canvas.addEventListener("mousemove",e)}),t.canvas.addEventListener("mouseup",function(i){t.canvas.removeEventListener("mousemove",e)}),t.canvas.addEventListener("touchstart",function(e){e.preventDefault();for(var i=0,a=e.changedTouches.length;i<a;i++)t.mx=e.changedTouches[i].pageX,t.my=e.changedTouches[i].pageY,t.createFireworks(t.cw/2,t.ch,t.mx,t.my)}),t.canvas.addEventListener("touchmove",function(e){e.preventDefault();for(var i=0,a=e.changedTouches.length;i<a;i++)t.mx=e.changedTouches[i].pageX,t.my=e.changedTouches[i].pageY,t.createFireworks(t.cw/2,t.ch,t.mx,t.my)})},t.clear=function(){t.particles=[],t.fireworks=[],t.ctx.clearRect(0,0,t.cw,t.ch)},t.updateDelta=function(){var e=Date.now();t.dt=(e-t.oldTime)/16,t.dt=t.dt>5?5:t.dt,t.oldTime=e},t.canvasLoop=function(){requestAnimFrame(t.canvasLoop,t.canvas),t.updateDelta(),t.ctx.globalCompositeOperation="destination-out",t.ctx.fillStyle="rgba(0,0,0,"+t.clearAlpha/100+")",t.ctx.fillRect(0,0,t.cw,t.ch),t.ctx.globalCompositeOperation="lighter",t.updateFireworks(),t.updateParticles(),t.drawFireworks(),t.drawParticles()},t.init();for(var r=4;r--;)setTimeout(function(){t.fireworks.push(new s(t.cw/2,t.ch,e(50,t.cw-50),e(50,t.ch/2)-50))},200*r)},fworks=new Fireworks;